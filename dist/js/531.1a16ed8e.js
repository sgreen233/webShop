"use strict";(self["webpackChunkno_router"]=self["webpackChunkno_router"]||[]).push([[531],{9531:function(e,t,o){o.r(t),o.d(t,{default:function(){return T}});var i=o(6768),l=o(4232);const s={class:"roomlist"},a={class:"grid-content bg-purple"},r={key:0,class:"roomdetail"},n={class:"title"},p={class:"table-container"},d={style:{margin:"5px"}},h={style:{display:"flex","justify-content":"space-between"}},m=["onClick"],u={style:{height:"25px","line-height":"20px"}},c={style:{height:"25px","line-height":"20px"}},k={style:{height:"240px"},class:"button_wrap"},b={slot:"footer",class:"dialog-footer"};function g(e,t,o,g,f,w){const v=(0,i.g2)("el-page-header"),F=(0,i.g2)("el-button"),y=(0,i.g2)("el-col"),T=(0,i.g2)("el-row"),N=(0,i.g2)("el-table-column"),_=(0,i.g2)("el-table"),x=(0,i.g2)("el-input"),A=(0,i.g2)("el-form-item"),C=(0,i.g2)("el-form"),L=(0,i.g2)("el-dialog");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(v,{onBack:w.goBack,content:"在线会议室列表",class:"roommassage"},null,8,["onBack"]),(0,i.Lk)("div",s,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(w.groupedRooms,((e,t)=>((0,i.uX)(),(0,i.Wv)(T,{gutter:20,key:t},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e,(e=>((0,i.uX)(),(0,i.Wv)(y,{span:8,key:e.roomNumber},{default:(0,i.k6)((()=>[(0,i.Lk)("div",a,[(0,i.bF)(F,{type:"primary",plain:"",onClick:t=>w.handleClick(e)},{default:(0,i.k6)((()=>[(0,i.Lk)("p",null,(0,l.v_)(e.roomName),1)])),_:2},1032,["onClick"])])])),_:2},1024)))),128))])),_:2},1024)))),128))]),f.selectroom?((0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("p",n,(0,l.v_)(f.roomlist[f.roomindex].roomName),1),(0,i.Lk)("p",null,"房间号: "+(0,l.v_)(f.roomlist[f.roomindex].roomNumber),1),(0,i.Lk)("p",null,"位置: "+(0,l.v_)(f.roomlist[f.roomindex].location),1),(0,i.Lk)("p",null,"容量: "+(0,l.v_)(f.roomlist[f.roomindex].peopleNumber)+"人",1)])):(0,i.Q3)("",!0),(0,i.bF)(F,{type:"primary",plain:"",onClick:t[0]||(t[0]=e=>w.booClick()),class:"bookbut",disabled:!f.selectroom},{default:(0,i.k6)((()=>t[4]||(t[4]=[(0,i.eW)(" 预 订 ")]))),_:1},8,["disabled"]),(0,i.Lk)("div",p,[(0,i.bF)(_,{data:f.roombooklist,class:"massageTable",stripe:""},{default:(0,i.k6)((()=>[(0,i.bF)(N,{prop:"roomNumber",label:"房间号",width:"60"}),(0,i.bF)(N,{prop:"bookname",label:"姓名",width:"40"}),(0,i.bF)(N,{"show-overflow-tooltip":"",prop:"formattedStartTime",label:"借用日期",width:"125"}),(0,i.bF)(N,{"show-overflow-tooltip":"",prop:"formattedEndTime",label:"借用日期",width:"125"}),(0,i.bF)(N,{prop:"use",label:"是否使用",width:"60"}),(0,i.bF)(N,{prop:"peopleNumber",label:"实际人数",width:"40"})])),_:1},8,["data"])]),(0,i.Lk)("div",null,[(0,i.bF)(L,{title:"预约",modelValue:f.isAppoint,"onUpdate:modelValue":t[3]||(t[3]=e=>f.isAppoint=e),width:"100%",modal:!0,class:"bookdialog"},{default:(0,i.k6)((()=>[(0,i.bF)(C,{"label-width":"100%",model:f.appointForm},{default:(0,i.k6)((()=>[(0,i.Lk)("div",d,[(0,i.Lk)("div",h,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(f.week,((e,t)=>((0,i.uX)(),(0,i.CE)("span",{key:t,class:(0,l.C4)({top_style:0==e.is_active,top_active:1==e.is_active}),onClick:o=>w.changWeek(e,t)},[(0,i.Lk)("div",u,(0,l.v_)(e.date),1),(0,i.Lk)("div",c,(0,l.v_)(e.day),1)],10,m)))),128))]),t[5]||(t[5]=(0,i.Lk)("div",{style:{display:"flex",margin:"20px 50px","font-size":"18px","justify-content":"space-between"}},[(0,i.Lk)("div",{style:{display:"flex"}},[(0,i.Lk)("div",{style:{"background-color":"#ffa4a4",width:"40px",height:"20px","margin-right":"10px"}}),(0,i.Lk)("div",null,"已有预约")]),(0,i.Lk)("div",{style:{display:"flex"}},[(0,i.Lk)("div",{style:{"background-color":"#3EA7F1",width:"40px",height:"20px","margin-right":"10px"}}),(0,i.Lk)("div",null,"当前预约")])],-1)),(0,i.Lk)("div",k,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(f.bookSchedule[f.dateNow],((t,o)=>((0,i.uX)(),(0,i.Wv)(F,{key:e.index,onClick:e=>w.changTime(t,o),style:{width:"auto","margin-left":"10px"},type:0===t?"":1===t?"danger":"primary",disabled:1==t,class:"button_style"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(o),1)])),_:2},1032,["onClick","type","disabled"])))),128))])]),(0,i.bF)(T,{gutter:5},{default:(0,i.k6)((()=>[(0,i.bF)(y,{span:10},{default:(0,i.k6)((()=>[t[6]||(t[6]=(0,i.eW)("负责人姓名 ")),(0,i.bF)(A,{label:"负责人姓名"},{default:(0,i.k6)((()=>[(0,i.bF)(x,{placeholder:"请输入会议人数",modelValue:f.appointForm.bookname,"onUpdate:modelValue":t[1]||(t[1]=e=>f.appointForm.bookname=e),clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(y,{span:10,style:{"margin-left":"10px"}},{default:(0,i.k6)((()=>[t[7]||(t[7]=(0,i.eW)("会议人数 ")),(0,i.bF)(A,{label:"会议人数"},{default:(0,i.k6)((()=>[(0,i.bF)(x,{placeholder:"请输入会议人数",modelValue:f.appointForm.peopleNumber,"onUpdate:modelValue":t[2]||(t[2]=e=>f.appointForm.peopleNumber=e),clearable:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),(0,i.Lk)("div",b,[(0,i.bF)(F,{onClick:w.closeAppoint},{default:(0,i.k6)((()=>t[8]||(t[8]=[(0,i.eW)("取消")]))),_:1},8,["onClick"]),(0,i.bF)(F,{type:"primary",onClick:w.saveAppoint,style:{"margin-left":"20px"}},{default:(0,i.k6)((()=>t[9]||(t[9]=[(0,i.eW)("确定")]))),_:1},8,["onClick"])])])),_:1},8,["modelValue"])])],64)}o(4114);var f=o(4200),w=o(167),v={data(){return{roomlist:[],roombooklist:[],currentroomlist:[],bookSchedule:[],roomindex:null,selectroom:!1,isAppoint:!1,week:[],appointForm:{startTime:null,endTime:null,bookname:null,peopleNumber:null,roomNumber:null,isUse:!1},dateNow:null,appointTimeArr:[]}},created(){},methods:{goBack(){console.log("go back")},getlist(){(0,f.A)({url:"room/getlist",method:"get",data:null}).then((e=>{this.roomlist=e})).catch((e=>{console.log(e)}))},getroombooklist(){(0,f.A)({url:"room/getschedulelist",method:"get",data:null}).then((e=>{this.roombooklist=e.map((e=>({...e,formattedStartTime:this.formatDateTime(e.startTime),formattedEndTime:this.formatDateTime(e.endTime)})))})).catch((e=>{console.log(e)}))},handleClick(e){this.roomindex=this.roomlist.findIndex((t=>t.roomNumber===e.roomNumber)),this.selectroom=null!=this.roomindex},booClick(){(0,f.A)({url:"room/getscheduletime?roomNumber="+this.roomlist[this.roomindex].roomNumber,method:"get",data:null}).then((e=>{this.bookSchedule=e,this.week=this.dealTime(),this.isAppoint=!0})).catch((e=>{console.log(e)}))},dealTime(){let e=[];return Object.keys(this.bookSchedule).forEach((t=>{let o="2024/"+t;const i=new Date(o.replace(/-/g,"/")),l=["周日","周一","周二","周三","周四","周五","周六"];let s=l[i.getDay()];e.push({date:t,day:s,is_active:0})})),e},changWeek(e,t){for(let o=0;o<this.week.length;o++)this.week[o].is_active=0;this.week[t].is_active=1,this.dateNow=e.date},closeAppoint(){this.isAppoint=!1;for(let e=0;e<this.week.length;e++)this.week[e].is_active=0;this.week[0].is_active=1,this.appointForm.bookname="",this.appointForm.peopleNumber=null,null!==this.dateNow&&(Object.keys(this.bookSchedule[this.dateNow]).forEach((e=>{2===this.bookSchedule[this.dateNow][e]&&(this.bookSchedule[this.dateNow][e]=0)})),this.dateNow=null)},saveAppoint(){this.appointForm.isUse=!1,this.appointForm.roomNumber=this.roomlist[this.roomindex].roomNumber,console.log(this.appointForm),(0,f.A)({url:"room/addschedule",method:"post",data:this.appointForm}).then((e=>{console.log(e),this.getroombooklist(),this.closeAppoint()})).catch((e=>{console.log(e)}))},padZero(e,t=2){let o=e+"";while(o.length<t)o="0"+o;return o},changTime(e,t){if(this.appointTimeArr.length<2){if(this.bookSchedule[this.dateNow][t]=2,this.appointTimeArr.push(t),2==this.appointTimeArr.length)if(this.appointTimeArr[0]==this.appointTimeArr[1])this.bookSchedule[this.dateNow][t]=0,this.appointTimeArr=[];else{this.appointTimeArr=this.appointTimeArr.sort((function(e,t){const o=new Date("2024-01-01T"+e),i=new Date("2024-01-01T"+t);return o<i?-1:o>i?1:0}));const e=new Date("2000-01-01T"+this.appointTimeArr[0]),t=new Date("2000-01-01T"+this.appointTimeArr[1]);let o=(t.getTime()-e.getTime())/18e5;const i=18e5;let l=e;for(let s=0;s<o;s++){l=new Date(l.getTime()+i);let e=l.getHours(),t=l.getMinutes();if(console.log(`${this.padZero(e)}:${this.padZero(t)}`),1==this.bookSchedule[this.dateNow][`${this.padZero(e)}:${this.padZero(t)}`]){(0,w.nk)({message:"已预约过的时间不允许预约",type:"warning"}),Object.keys(this.bookSchedule[this.dateNow]).forEach((e=>{2===this.bookSchedule[this.dateNow][e]&&(this.bookSchedule[this.dateNow][e]=0)})),this.appointForm.startTime="",this.appointForm.endTime="";break}this.bookSchedule[this.dateNow][`${this.padZero(e)}:${this.padZero(t)}`]=2}this.appointForm.startTime="2024/"+this.dateNow+" "+this.appointTimeArr[0],this.appointForm.endTime="2024/"+this.dateNow+" "+this.appointTimeArr[1]}}else(this.appointTimeArr.length=3)&&(Object.keys(this.bookSchedule[this.dateNow]).forEach((e=>{2===this.bookSchedule[this.dateNow][e]&&(this.bookSchedule[this.dateNow][e]=0)})),this.appointTimeArr=[],this.appointTimeArr.push(t),this.bookSchedule[this.dateNow][t]=2)},formatDateTime(e){const t=new Date(e),o=t.getFullYear().toString().substr(-2),i=`0${t.getMonth()+1}`.slice(-2),l=`0${t.getDate()}`.slice(-2),s=`0${t.getHours()}`.slice(-2),a=`0${t.getMinutes()}`.slice(-2);return`${o}/${i}/${l}-${s}:${a}`}},mounted(){this.getlist(),this.getroombooklist()},computed:{groupedRooms(){const e=[];for(let t=0;t<this.roomlist.length;t+=3)e.push(this.roomlist.slice(t,t+3));return e}}},F=o(1241);const y=(0,F.A)(v,[["render",g],["__scopeId","data-v-7e5d5dda"]]);var T=y}}]);
//# sourceMappingURL=531.1a16ed8e.js.map